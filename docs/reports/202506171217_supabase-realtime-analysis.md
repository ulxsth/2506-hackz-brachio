# Supabase Realtime ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£åˆ†æ ğŸš€

## æ¦‚è¦
TYPE 2 LIVEï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 100äººè¦æ¨¡ã®ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ï¼‰ã«ãŠã‘ã‚‹Supabase Realtimeã®é©æ€§ã‚’èª¿æŸ»ã—ã¾ã—ãŸã€‚

## åˆ¶é™ãƒ»æ€§èƒ½ã®èª¿æŸ»çµæœ ğŸ“Š

### åŒæ™‚æ¥ç¶šæ•°ã®åˆ¶é™
- **Free Plan**: 200åŒæ™‚æ¥ç¶š
- **Pro Plan**: 500åŒæ™‚æ¥ç¶š (ãã®å¾Œ$10/1000æ¥ç¶š)
- **Team Plan**: 500åŒæ™‚æ¥ç¶š (ãã®å¾Œ$10/1000æ¥ç¶š)
- **Enterprise**: ã‚«ã‚¹ã‚¿ãƒ ï¼ˆç›¸è«‡ï¼‰

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®¹é‡ãƒ»é »åº¦
- **Free Plan**: æœˆé–“200ä¸‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **Pro Plan**: æœˆé–“500ä¸‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (ãã®å¾Œ$2.50/100ä¸‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
- **æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚º**: 
  - Free: 250KB
  - Pro/Team: 3MB

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç‰¹æ€§
- **æŠ€è¡“**: Elixir + Phoenix Framework
- **WebSocket**: é«˜æ€§èƒ½ãªæ¥ç¶šç®¡ç†
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡**: ä¿è¨¼ãªã—ï¼ˆãƒ™ã‚¹ãƒˆã‚¨ãƒ•ã‚©ãƒ¼ãƒˆï¼‰
- **ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: Broadcastã¯ä¸€æ™‚çš„ã€Presenceã¯è¨ˆç®—é›†ç´„çš„

## 100äººè¦æ¨¡ã®ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã§ã®é©æ€§åˆ†æ ğŸ¯

### âœ… é©ã—ã¦ã„ã‚‹ç‚¹

1. **æ¥ç¶šæ•°**: 100äººãªã‚‰Free Planã§ã‚‚ååˆ†ï¼ˆ200æ¥ç¶šåˆ¶é™ï¼‰
2. **ä½é…å»¶**: Broadcastã¯ä¸€æ™‚çš„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§DBçµŒç”±ãªã—
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§**: WebSocketãƒ™ãƒ¼ã‚¹ã§é«˜æ€§èƒ½
4. **æŠ€è¡“çš„ä¿¡é ¼æ€§**: Elixir/Phoenixã®ä¸¦è¡Œå‡¦ç†ã«å¼·ã¿

### âš ï¸ æ‡¸å¿µç‚¹ãƒ»åˆ¶ç´„

1. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ä¿è¨¼ãªã—**
   - é‡è¦ãªã‚²ãƒ¼ãƒ çŠ¶æ…‹ã¯åˆ¥é€”DBã«ä¿å­˜å¿…è¦
   - ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€²æ—ã®ä¸€éƒ¨ãƒ­ã‚¹ãƒˆã®å¯èƒ½æ€§

2. **Presenceæ©Ÿèƒ½ã®è¨ˆç®—è² è·**
   - 100äººã®çŠ¶æ…‹åŒæœŸã¯è¨ˆç®—é›†ç´„çš„
   - å…¬å¼ã§ã‚‚ã€Œæ§ãˆã‚ã«ä½¿ç”¨ã€æ¨å¥¨

3. **é«˜é »åº¦æ›´æ–°ã§ã®èª²é¡Œ**
   - ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€Ÿåº¦ã«ã‚ˆã£ã¦ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é‡ãŒæ€¥å¢—
   - æœˆé–“åˆ¶é™ã¸ã®å½±éŸ¿

## æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ ğŸ—ï¸

### 1. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰è¨­è¨ˆ
```
- Broadcast: ã‚­ãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- Presence: å‚åŠ è€…çŠ¶æ…‹ã€ã€Œèª°ãŒå…¥åŠ›ä¸­ã€è¡¨ç¤º
- Postgres Changes: ã‚²ãƒ¼ãƒ çµæœã€é‡è¦ãªçŠ¶æ…‹å¤‰æ›´
```

### 2. è² è·åˆ†æ•£æˆ¦ç•¥
```
- éƒ¨å±‹ã”ã¨ã«Channelã‚’åˆ†é›¢
- ä¸è¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- Presenceã®æ›´æ–°é »åº¦ã‚’åˆ¶å¾¡ï¼ˆã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ï¼‰
```

### 3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ
```
- é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã¯å¿…ãšDBæ°¸ç¶šåŒ–
- æ¥ç¶šæ–­ã§ã®çŠ¶æ…‹å¾©æ—§æ©Ÿèƒ½
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚¹ãƒˆæ™‚ã®å†åŒæœŸæ©Ÿèƒ½
```

## TYPE 2 LIVEã§ã®å®Ÿè£…æ¨å¥¨ ğŸ®

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆ
```typescript
// è»½é‡ãªBroadcastãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
interface TypingEvent {
  userId: string;
  progress: number;  // 0-100%
  timestamp: number;
}

// Presenceã§ã®çŠ¶æ…‹ç®¡ç†
interface UserPresence {
  userId: string;
  status: 'playing' | 'finished' | 'disconnected';
  lastSeen: number;
}
```

### è² è·è»½æ¸›ã®ãŸã‚ã®å·¥å¤«
1. **ãƒ‡ãƒã‚¦ãƒ³ã‚¹**: ã‚­ãƒ¼ã‚¹ãƒˆãƒ­ãƒ¼ã‚¯ã‚’100msé–“éš”ã§é€ä¿¡
2. **å·®åˆ†æ›´æ–°**: é€²æ—ã®å¤‰åŒ–æ™‚ã®ã¿é€ä¿¡
3. **Channelåˆ†é›¢**: ã‚²ãƒ¼ãƒ éƒ¨å±‹ã”ã¨ã«ç‹¬ç«‹ã—ãŸãƒãƒ£ãƒ³ãƒãƒ«

## çµè«– ğŸ“‹

### ğŸŸ¢ é©æ€§: ååˆ†ã«å¯èƒ½
- 100äººè¦æ¨¡ãªã‚‰æŠ€è¡“çš„ã«å®Ÿç¾å¯èƒ½
- é©åˆ‡ãªè¨­è¨ˆã«ã‚ˆã‚Šé«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›

### ğŸŸ¡ æ¡ä»¶ä»˜ãæ¨å¥¨
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ä¿è¨¼ãªã—ã‚’å‰æã¨ã—ãŸè¨­è¨ˆ
- é‡è¦ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã¯å¿…é ˆ
- é©åˆ‡ãªè² è·åˆ†æ•£ã¨ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°

### ğŸ”´ æ³¨æ„ç‚¹
- æ€¥æ¿€ãªã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ300äººè¶…ï¼‰ã§ã¯å†æ¤œè¨å¿…è¦
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é‡ã®ç¶™ç¶šçš„ãªç›£è¦–ãŒå¿…è¦
- ä»£æ›¿æ‰‹æ®µï¼ˆWebRTCã€å°‚ç”¨ã‚µãƒ¼ãƒãƒ¼ï¼‰ã®æ¤œè¨ã‚‚è¦–é‡ã«

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— ğŸ¯
1. ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã®è² è·ãƒ†ã‚¹ãƒˆå®Ÿæ–½
2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é‡ã®å®Ÿæ¸¬å€¤å–å¾—
3. æ®µéšçš„ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨ˆç”»ã®ç­–å®š

---

## ğŸ¯ Broadcast vs Presence æ¯”è¼ƒåˆ†æ

### å‰ææ¡ä»¶
- **ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°**: å˜èªå…¥åŠ›å®Œäº† â†’ æ­£èª¤åˆ¤å®šå®Œäº†å¾Œ
- **æƒ³å®šé »åº¦**: å¹³å‡1åˆ†é–“ã«5-10å›ã®å˜èªé€ä¿¡
- **ãƒ‡ãƒ¼ã‚¿ç‰¹æ€§**: å˜èªã€å¾—ç‚¹ã€é€²æ—çŠ¶æ³ã®æ›´æ–°

### ğŸ“¡ Broadcast ã®ç‰¹æ€§

**âœ… é©ã—ã¦ã„ã‚‹ç†ç”±**:
1. **å˜ç™ºã‚¤ãƒ™ãƒ³ãƒˆå‘ã‘**: ã€Œå˜èªé€ä¿¡å®Œäº†ã€ã¨ã„ã†ç¬é–“çš„ãªã‚¤ãƒ™ãƒ³ãƒˆã«æœ€é©
2. **è»½é‡**: ä¸€æ™‚çš„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§DBã‚’çµŒç”±ã—ãªã„
3. **ä½é…å»¶**: ç›´æ¥çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡
4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«**: 100äººè¦æ¨¡ã§ã‚‚è² è·ãŒå°‘ãªã„

**âš ï¸ æ³¨æ„ç‚¹**:
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ä¿è¨¼ãªã—
- æ–°è¦å‚åŠ è€…ã¯éå»ã®çŠ¶æ…‹ã‚’å—ä¿¡ã§ããªã„

**æ¨å¥¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```typescript
interface WordSubmissionEvent {
  userId: string;
  word: string;
  isCorrect: boolean;
  score: number;
  totalScore: number;
  comboCount: number;
  timestamp: number;
}
```

### ğŸ‘¥ Presence ã®ç‰¹æ€§

**âœ… é©ã—ã¦ã„ã‚‹ç†ç”±**:
1. **çŠ¶æ…‹åŒæœŸ**: å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç¾åœ¨çŠ¶æ…‹ã‚’è‡ªå‹•åŒæœŸ
2. **æ–°è¦å‚åŠ è€…å¯¾å¿œ**: é€”ä¸­å‚åŠ ã§ã‚‚ç¾åœ¨çŠ¶æ…‹ã‚’å³åº§ã«å–å¾—
3. **è‡ªå‹•cleanup**: åˆ‡æ–­æ™‚ã®çŠ¶æ…‹è‡ªå‹•å‰Šé™¤

**âš ï¸ æ‡¸å¿µç‚¹**:
- **è¨ˆç®—é›†ç´„çš„**: 100äººã®çŠ¶æ…‹æ›´æ–°ã¯é‡ã„å‡¦ç†
- **é »ç¹æ›´æ–°ã«ä¸å‘ã**: 1åˆ†é–“ã«5-10å›ã®æ›´æ–°ã¯è² è·å¤§
- **å…¬å¼æ¨å¥¨**: ã€Œæ§ãˆã‚ã«ä½¿ç”¨ã€ã¨ã®è¨˜è¼‰

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä¾‹**:
```typescript
interface PlayerPresence {
  userId: string;
  totalScore: number;
  comboCount: number;
  status: 'playing' | 'finished';
  lastWordTime: number;
  rank: number;
}
```

## ğŸ† æ¨å¥¨: **Broadcastä¸­å¿ƒã®è¨­è¨ˆ**

### ç†ç”±
1. **ã‚¤ãƒ™ãƒ³ãƒˆç‰¹æ€§ã«ãƒãƒƒãƒ**: å˜èªé€ä¿¡ã¯å˜ç™ºã‚¤ãƒ™ãƒ³ãƒˆ
2. **é »åº¦ã¸ã®é©å¿œ**: 1åˆ†é–“5-10å›ç¨‹åº¦ãªã‚‰å•é¡Œãªã—
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: Presenceã‚ˆã‚Šè»½é‡
4. **æ‹¡å¼µæ€§**: å°†æ¥çš„ãªæ©Ÿèƒ½è¿½åŠ ã«æŸ”è»Ÿ

### è£œå®Œçš„ãªPresenceæ´»ç”¨
```typescript
// è»½é‡ãªPresenceï¼ˆæ›´æ–°é »åº¦ã‚’æŠ‘åˆ¶ï¼‰
interface MinimalPresence {
  userId: string;
  status: 'active' | 'inactive';
  lastSeen: number;
  // ã‚¹ã‚³ã‚¢ãªã©é »ç¹ã«å¤‰ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯å«ã‚ãªã„
}
```

## ğŸ® å®Ÿè£…æˆ¦ç•¥

### 1. ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆBroadcastï¼‰
```
å˜èªé€ä¿¡ â†’ æ­£èª¤åˆ¤å®š â†’ Broadcasté…ä¿¡ â†’ å…¨å“¡ã«å³åº§åæ˜ 
```

### 2. çŠ¶æ…‹ç®¡ç†ï¼ˆDB + è»½é‡Presenceï¼‰
```
- é‡è¦ãƒ‡ãƒ¼ã‚¿: PostgreSQLæ°¸ç¶šåŒ–
- æ¥ç¶šçŠ¶æ…‹: è»½é‡Presence
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ: Broadcast
```

### 3. è² è·åˆ†æ•£
```typescript
// ãƒ‡ãƒã‚¦ãƒ³ã‚¹ä¾‹
const debouncedBroadcast = debounce((data) => {
  channel.send({
    type: 'broadcast',
    event: 'word_submitted',
    payload: data
  })
}, 50) // 50msé–“éš”åˆ¶é™
```

## ğŸ“Š äºˆæƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é‡
- **100äºº Ã— 8å˜èª/åˆ† Ã— 60åˆ†**: 48,000ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸/æ™‚é–“
- **æœˆé–“æ›ç®—**: ç´„100ä¸‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆFree Planã®åŠåˆ†ç¨‹åº¦ï¼‰
- **åˆ¤å®š**: ååˆ†ã«è¨±å®¹ç¯„å›²å†… âœ…
