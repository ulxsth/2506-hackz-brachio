# Tasks: å˜èªãƒ‡ãƒ¼ã‚¿åœ§ç¸®ãƒ»äº‹å‰å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

## ğŸ“‹ å®Ÿè£…è¨ˆç”»æ¦‚è¦

### ğŸ¯ ç›®æ¨™
ç¾åœ¨ã®29èªãƒ‡ãƒ¼ã‚¿ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ãƒã‚¤ãƒŠãƒªåœ§ç¸® + Supabase Storage + äº‹å‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã€‚é–‹ç™ºè€…ãŒä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã§ãã‚‹ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã€‚

### ğŸš€ åŸºæœ¬å®Ÿè£…ç¯„å›²ï¼ˆPhase 1ï¼‰
1. Supabase Storageã¸ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã‚·ã‚¹ãƒ†ãƒ 
2. gzipåœ§ç¸®ã«ã‚ˆã‚‹åŸºæœ¬çš„ãªå®¹é‡å‰Šæ¸›
3. æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®äº‹å‰ç”Ÿæˆ
4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®åŸºæœ¬çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»å±•é–‹æ©Ÿèƒ½

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

### æ–°è¦ä½œæˆäºˆå®š
- `scripts/build-dictionary.js` - è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/upload-to-storage.js` - Supabase Storageã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `frontend/lib/dictionary-loader.ts` - è¾æ›¸ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼
- `frontend/lib/word-index.ts` - æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†

### æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‚ç…§ãƒ»ä¿®æ­£ï¼‰
- `supabase/seed.sql` - ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ï¼ˆ29èªï¼‰
- `frontend/lib/database.types.ts` - å‹å®šç¾©
- `frontend/app/game/page.tsx` - ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¾æ›¸ãƒ­ãƒ¼ãƒ€ãƒ¼çµ±åˆï¼‰

### è¨­å®šãƒ»ç’°å¢ƒ
- `package.json` - ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 
- `supabase/config.toml` - Storageè¨­å®šç¢ºèª

## ğŸ”§ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Step 1: é–‹ç™ºç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
**ç›®çš„**: é–‹ç™ºè€…ãŒä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆãƒ»æ›´æ–°ã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ 

#### 1.1 è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/build-dictionary.js`
- **æ©Ÿèƒ½**:
  - Supabaseã‹ã‚‰æœ€æ–°ã®it_termsãƒ‡ãƒ¼ã‚¿å–å¾—
  - æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆï¼ˆa-zå„æ–‡å­—ã‚’å«ã‚€å˜èªã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰
  - æœ€é©åŒ–ã•ã‚ŒãŸJSONãƒ‡ãƒ¼ã‚¿æ§‹é€ ä½œæˆ
  - gzipåœ§ç¸®é©ç”¨
  - ãƒ­ãƒ¼ã‚«ãƒ«dist/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›

#### 1.2 Supabase Storageã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/upload-to-storage.js`
- **æ©Ÿèƒ½**:
  - ç”Ÿæˆã•ã‚ŒãŸåœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰
  - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµæœã®ç¢ºèªãƒ»ãƒ­ã‚°å‡ºåŠ›

#### 1.3 package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 
```json
{
  "scripts": {
    "build:dictionary": "node scripts/build-dictionary.js",
    "upload:dictionary": "node scripts/upload-to-storage.js",
    "dict:update": "npm run build:dictionary && npm run upload:dictionary"
  }
}
```

### Step 2: ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

#### 2.1 åœ§ç¸®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
```typescript
interface CompressedDictionary {
  metadata: {
    version: string;
    wordCount: number;
    lastUpdated: string;
    compression: 'gzip';
  };
  letterIndex: {
    [letter: string]: number[]; // è©²å½“æ–‡å­—ã‚’å«ã‚€å˜èªã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ—
  };
  words: {
    id: number;
    text: string;
    romaji: string;
    difficulty: number;
    description: string;
    aliases: string[];
  }[];
}
```

#### 2.2 æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
```typescript
function buildLetterIndex(words: ITTerm[]): Record<string, number[]> {
  const index: Record<string, number[]> = {};
  
  // a-zåˆæœŸåŒ–
  for (let i = 0; i < 26; i++) {
    const letter = String.fromCharCode(97 + i); // 'a' to 'z'
    index[letter] = [];
  }
  
  // å„å˜èªã®å«æœ‰æ–‡å­—ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–
  words.forEach((word, wordIndex) => {
    const uniqueLetters = new Set(word.text.toLowerCase().match(/[a-z]/g) || []);
    uniqueLetters.forEach(letter => {
      index[letter].push(wordIndex);
    });
  });
  
  return index;
}
```

### Step 3: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ­ãƒ¼ãƒ€ãƒ¼å®Ÿè£…

#### 3.1 è¾æ›¸ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/lib/dictionary-loader.ts`
- **æ©Ÿèƒ½**:
  - Supabase Storageã‹ã‚‰åœ§ç¸®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
  - gzipå±•é–‹
  - ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼‰

#### 3.2 æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/lib/word-index.ts`
- **æ©Ÿèƒ½**:
  - æŒ‡å®šæ–‡å­—ã‚’å«ã‚€å˜èªã®é«˜é€Ÿæ¤œç´¢ï¼ˆO(1)ï¼‰
  - è¾æ›¸ãƒ‡ãƒ¼ã‚¿ã¨ã®é€£æº
  - åˆ¶ç´„ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

### Step 4: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ

#### 4.1 æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/game/page.tsx`
- **å¤‰æ›´å†…å®¹**:
  - ç¾åœ¨ã®Supabaseç›´æ¥ã‚¯ã‚¨ãƒªã‚’è¾æ›¸ãƒ­ãƒ¼ãƒ€ãƒ¼ä½¿ç”¨ã«å¤‰æ›´
  - é«˜é€Ÿãªåˆ¶ç´„ãƒã‚§ãƒƒã‚¯å®Ÿè£…
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–

#### 4.2 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
- è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã¯æ—¢å­˜ã®Supabaseã‚¯ã‚¨ãƒªã«è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
- ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®å¯è¦–åŒ–

## ğŸ—‚ï¸ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆå®Ÿè£…å¾Œï¼‰

```
scripts/
â”œâ”€â”€ build-dictionary.js      # è¾æ›¸ç”Ÿæˆ
â”œâ”€â”€ upload-to-storage.js     # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â””â”€â”€ package.json            # ä¾å­˜é–¢ä¿‚

frontend/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ dictionary-loader.ts # è¾æ›¸ãƒ­ãƒ¼ãƒ€ãƒ¼
â”‚   â”œâ”€â”€ word-index.ts       # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†
â”‚   â””â”€â”€ ...existing files...
â””â”€â”€ ...existing structure...

dist/                        # ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ dictionary-v1.0.0.json.gz
â”œâ”€â”€ dictionary-latest.json.gz
â””â”€â”€ build-log.txt

supabase-storage://
â””â”€â”€ dictionaries/
    â”œâ”€â”€ v1.0.0-dictionary.json.gz
    â””â”€â”€ latest/
        â””â”€â”€ dictionary.json.gz
```

### å‹•ä½œç¢ºèª
- [ ] ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆæˆåŠŸ
- [ ] gzipåœ§ç¸®ãƒ»å±•é–‹ã®æ­£å¸¸å‹•ä½œ
- [ ] Supabase Storageã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ
- [ ] æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹é«˜é€Ÿæ¤œç´¢å‹•ä½œ

## ğŸ“ é–‹ç™ºè€…å‘ã‘ä½¿ç”¨æ–¹æ³•

### è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°æ‰‹é †
```bash
# 1. Supabaseã®seed.sqlã‚’æ›´æ–°
# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run supabase:reset

# 3. è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
npm run dict:update

# 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹•ä½œç¢ºèª
npm run dev
```

### ãƒ‡ãƒãƒƒã‚°ãƒ»ç¢ºèªã‚³ãƒãƒ³ãƒ‰
```bash
# ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèª
ls -la dist/

# åœ§ç¸®ç‡ç¢ºèª
npm run build:dictionary -- --verbose

# Supabase Storageç¢ºèª
npm run supabase:storage list dictionaries
```

---

## ğŸ¯ ä»Šå›ã®ä½œæ¥­ç¯„å›²

**Step 1.1ã®ã¿é›†ä¸­å®Ÿè£…**: `scripts/build-dictionary.js`ã®ä½œæˆã¨å‹•ä½œç¢ºèª
- æœ€å°é™ã®æ©Ÿèƒ½ã§å‹•ä½œã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½œæˆ
- 29èªãƒ‡ãƒ¼ã‚¿ã§ã®æ¤œè¨¼å®Œäº†
- ä»–ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯å‹•ä½œç¢ºèªå¾Œã«é †æ¬¡è¿½åŠ 

ã“ã®è¨ˆç”»ã§é€²ã‚ã‚‹ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰æ®µéšçš„ã«æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ï¼
